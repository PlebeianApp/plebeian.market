name: Node CI

on: [push]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    # - name: Create .ssh directory and add server to known_hosts
    #   run: |
    #     mkdir -p ~/.ssh
    #     echo "${{ secrets.KNOWN_HOSTS }}" >> ~/.ssh/known_hosts
    - run: sudo apt install sshpass 

    - name: rsync
      # run: rsync -avz --delete . ${{ secrets.REMOTE_USER }}@${{ secrets.REMOTE_HOST }}:plebeian.market
      run: rsync --rsh="/usr/bin/sshpass -p "${{ secrets.REMOTE_PASSWORD }}" ssh -o StrictHostKeyChecking=no -l root" . ${{ secrets.REMOTE_USER }}@${{ secrets.REMOTE_HOST }}:plebeian.market
      # env: 
      #   RSYNC_PASSWORD: ${{ secrets.REMOTE_PASSWORD }}

    # - name: Deploy final assets to server
    #   uses: appleboy/ssh-action@master
    #   with:
    #     host: ${{ secrets.REMOTE_HOST }}
    #     username: ${{ secrets.REMOTE_USER }}
    #     password: ${{ secrets.REMOTE_PASSWORD }}

    #     script: |
    #       rsync -avz --delete . /home/deployer/plebeian.market/

