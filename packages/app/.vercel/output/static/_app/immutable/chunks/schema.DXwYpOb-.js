var Y=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var s=(i,t,e)=>(Y(i,t,"read from private field"),e?e.call(i):t.get(i)),h=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},c=(i,t,e,r)=>(Y(i,t,"write to private field"),r?r.call(i,e):t.set(i,e),e);var u=(i,t,e)=>(Y(i,t,"access private method"),e);import{S as St,s as q,b as Ct,d as ft,e as pt,t as It,f as Ft,j as Qt,r as bt,n as yt,k as Ut,u as wt,i as Dt}from"./client.Vo4oKtvm.js";import{r as At,d as Z}from"./index.CU_89pqE.js";import{z as Et}from"./scheduler.D2KwwdHN.js";import{z as a}from"./index.DXqQCM1T.js";import{v as xt}from"./utils.DzuHJZus.js";var g,o,M,p,I,D,R,T,A,E,F,Q,O,x,U,P,j,$,B,tt,W,et,_,st,k,it,z,rt,N,at,K,Rt,vt,Lt=(vt=class extends St{constructor(t,e){super();h(this,U);h(this,j);h(this,B);h(this,W);h(this,_);h(this,k);h(this,z);h(this,N);h(this,K);h(this,g,void 0);h(this,o,void 0);h(this,M,void 0);h(this,p,void 0);h(this,I,void 0);h(this,D,void 0);h(this,R,void 0);h(this,T,void 0);h(this,A,void 0);h(this,E,void 0);h(this,F,void 0);h(this,Q,void 0);h(this,O,void 0);h(this,x,new Set);this.options=e,c(this,g,t),c(this,R,null),this.bindMethods(),this.setOptions(e)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(s(this,o).addObserver(this),gt(s(this,o),this.options)?u(this,U,P).call(this):this.updateResult(),u(this,_,st).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return nt(s(this,o),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return nt(s(this,o),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,u(this,k,it).call(this),u(this,z,rt).call(this),s(this,o).removeObserver(this)}setOptions(t,e){const r=this.options,d=s(this,o);if(this.options=s(this,g).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");u(this,N,at).call(this),s(this,o).setOptions(this.options),r._defaulted&&!q(this.options,r)&&s(this,g).getQueryCache().notify({type:"observerOptionsUpdated",query:s(this,o),observer:this});const l=this.hasListeners();l&&mt(s(this,o),d,this.options,r)&&u(this,U,P).call(this),this.updateResult(e),l&&(s(this,o)!==d||this.options.enabled!==r.enabled||this.options.staleTime!==r.staleTime)&&u(this,j,$).call(this);const b=u(this,B,tt).call(this);l&&(s(this,o)!==d||this.options.enabled!==r.enabled||b!==s(this,O))&&u(this,W,et).call(this,b)}getOptimisticResult(t){const e=s(this,g).getQueryCache().build(s(this,g),t),r=this.createResult(e,t);return Mt(this,r)&&(c(this,p,r),c(this,D,this.options),c(this,I,s(this,o).state)),r}getCurrentResult(){return s(this,p)}trackResult(t,e){const r={};return Object.keys(t).forEach(d=>{Object.defineProperty(r,d,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(d),e==null||e(d),t[d])})}),r}trackProp(t){s(this,x).add(t)}getCurrentQuery(){return s(this,o)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=s(this,g).defaultQueryOptions(t),r=s(this,g).getQueryCache().build(s(this,g),e);return r.isFetchingOptimistic=!0,r.fetch().then(()=>this.createResult(r,e))}fetch(t){return u(this,U,P).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),s(this,p)))}createResult(t,e){var dt;const r=s(this,o),d=this.options,l=s(this,p),b=s(this,I),m=s(this,D),w=t!==r?t.state:s(this,M),{state:f}=t;let n={...f},S=!1,y;if(e._optimisticResults){const v=this.hasListeners(),X=!v&&gt(t,e),Ot=v&&mt(t,r,e,d);(X||Ot)&&(n={...n,...Qt(f.data,t.options)}),e._optimisticResults==="isRestoring"&&(n.fetchStatus="idle")}let{error:ht,errorUpdatedAt:ct,status:C}=n;if(e.select&&n.data!==void 0)if(l&&n.data===(b==null?void 0:b.data)&&e.select===s(this,T))y=s(this,A);else try{c(this,T,e.select),y=e.select(n.data),y=bt(l==null?void 0:l.data,y,e),c(this,A,y),c(this,R,null)}catch(v){c(this,R,v)}else y=n.data;if(e.placeholderData!==void 0&&y===void 0&&C==="pending"){let v;if(l!=null&&l.isPlaceholderData&&e.placeholderData===(m==null?void 0:m.placeholderData))v=l.data;else if(v=typeof e.placeholderData=="function"?e.placeholderData((dt=s(this,E))==null?void 0:dt.state.data,s(this,E)):e.placeholderData,e.select&&v!==void 0)try{v=e.select(v),c(this,R,null)}catch(X){c(this,R,X)}v!==void 0&&(C="success",y=bt(l==null?void 0:l.data,v,e),S=!0)}s(this,R)&&(ht=s(this,R),y=s(this,A),ct=Date.now(),C="error");const G=n.fetchStatus==="fetching",H=C==="pending",J=C==="error",ut=H&&G,lt=y!==void 0;return{status:C,fetchStatus:n.fetchStatus,isPending:H,isSuccess:C==="success",isError:J,isInitialLoading:ut,isLoading:ut,data:y,dataUpdatedAt:n.dataUpdatedAt,error:ht,errorUpdatedAt:ct,failureCount:n.fetchFailureCount,failureReason:n.fetchFailureReason,errorUpdateCount:n.errorUpdateCount,isFetched:n.dataUpdateCount>0||n.errorUpdateCount>0,isFetchedAfterMount:n.dataUpdateCount>w.dataUpdateCount||n.errorUpdateCount>w.errorUpdateCount,isFetching:G,isRefetching:G&&!H,isLoadingError:J&&!lt,isPaused:n.fetchStatus==="paused",isPlaceholderData:S,isRefetchError:J&&lt,isStale:ot(t,e),refetch:this.refetch}}updateResult(t){const e=s(this,p),r=this.createResult(s(this,o),this.options);if(c(this,I,s(this,o).state),c(this,D,this.options),s(this,I).data!==void 0&&c(this,E,s(this,o)),q(r,e))return;c(this,p,r);const d={},l=()=>{if(!e)return!0;const{notifyOnChangeProps:b}=this.options,m=typeof b=="function"?b():b;if(m==="all"||!m&&!s(this,x).size)return!0;const L=new Set(m??s(this,x));return this.options.throwOnError&&L.add("error"),Object.keys(s(this,p)).some(w=>{const f=w;return s(this,p)[f]!==e[f]&&L.has(f)})};(t==null?void 0:t.listeners)!==!1&&l()&&(d.listeners=!0),u(this,K,Rt).call(this,{...d,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&u(this,_,st).call(this)}},g=new WeakMap,o=new WeakMap,M=new WeakMap,p=new WeakMap,I=new WeakMap,D=new WeakMap,R=new WeakMap,T=new WeakMap,A=new WeakMap,E=new WeakMap,F=new WeakMap,Q=new WeakMap,O=new WeakMap,x=new WeakMap,U=new WeakSet,P=function(t){u(this,N,at).call(this);let e=s(this,o).fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(Ct)),e},j=new WeakSet,$=function(){if(u(this,k,it).call(this),ft||s(this,p).isStale||!pt(this.options.staleTime))return;const e=It(s(this,p).dataUpdatedAt,this.options.staleTime)+1;c(this,F,setTimeout(()=>{s(this,p).isStale||this.updateResult()},e))},B=new WeakSet,tt=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(s(this,o)):this.options.refetchInterval)??!1},W=new WeakSet,et=function(t){u(this,z,rt).call(this),c(this,O,t),!(ft||this.options.enabled===!1||!pt(s(this,O))||s(this,O)===0)&&c(this,Q,setInterval(()=>{(this.options.refetchIntervalInBackground||Ft.isFocused())&&u(this,U,P).call(this)},s(this,O)))},_=new WeakSet,st=function(){u(this,j,$).call(this),u(this,W,et).call(this,u(this,B,tt).call(this))},k=new WeakSet,it=function(){s(this,F)&&(clearTimeout(s(this,F)),c(this,F,void 0))},z=new WeakSet,rt=function(){s(this,Q)&&(clearInterval(s(this,Q)),c(this,Q,void 0))},N=new WeakSet,at=function(){const t=s(this,g).getQueryCache().build(s(this,g),this.options);if(t===s(this,o))return;const e=s(this,o);c(this,o,t),c(this,M,t.state),this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))},K=new WeakSet,Rt=function(t){yt.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(s(this,p))}),s(this,g).getQueryCache().notify({query:s(this,o),type:"observerResultsUpdated"})})},vt);function Pt(i,t){return t.enabled!==!1&&i.state.data===void 0&&!(i.state.status==="error"&&t.retryOnMount===!1)}function gt(i,t){return Pt(i,t)||i.state.data!==void 0&&nt(i,t,t.refetchOnMount)}function nt(i,t,e){if(t.enabled!==!1){const r=typeof e=="function"?e(i):e;return r==="always"||r!==!1&&ot(i,t)}return!1}function mt(i,t,e,r){return(i!==t||r.enabled===!1)&&(!e.suspense||i.state.status!=="error")&&ot(i,e)}function ot(i,t){return t.enabled!==!1&&i.isStaleByTime(t.staleTime)}function Mt(i,t){return!q(i.getCurrentResult(),t)}function Tt(){return Ut()}function jt(i,t,e){const r=wt(e),d=Tt(),l=Dt(i)?i:At(i),b=Z([l,d],([f,n])=>{const S=r.defaultQueryOptions(f);return S._optimisticResults=n?"isRestoring":"optimistic",S}),m=new t(r,Et(b));b.subscribe(f=>{m.setOptions(f,{listeners:!1})});const L=Z(d,(f,n)=>{const S=f?()=>{}:m.subscribe(yt.batchCalls(n));return m.updateResult(),S}),{subscribe:w}=Z([L,b],([f,n])=>(f=m.getOptimisticResult(n),n.notifyOnChangeProps?f:m.trackResult(f)));return{subscribe:w}}function Kt(i,t){return jt(i,Lt,t)}const V=a.object({pageSize:a.coerce.number().min(1).default(10),page:a.coerce.number().min(1).default(1),order:a.enum(["asc","desc"]).default("asc")});V.extend({orderBy:a.enum(["createdAt","startDate","endDate"]).default("createdAt")});V.extend({orderBy:a.enum(["createdAt"]).default("createdAt"),userId:a.string().optional(),role:a.string().optional()});const Gt=V.extend({orderBy:a.enum(["createdAt","price"]).default("createdAt"),stallId:a.string().optional(),userId:a.string().optional(),catId:a.string().optional(),catName:a.string().optional()}),Ht=V.extend({stallId:a.string().optional(),userId:a.string().optional(),orderBy:a.enum(["createdAt"]).default("createdAt")}),Jt=V.extend({userId:a.string().optional(),catId:a.string().optional(),catName:a.string().optional()});a.object({instancePk:a.string().startsWith("npub"),ownerPk:a.string().startsWith("npub").optional(),adminsList:a.array(a.string().startsWith("npub")).optional(),instanceName:a.string(),logoUrl:a.union([a.string().url(),a.enum(xt)]).optional(),contactEmail:a.string().email().optional(),defaultCurrency:a.string(),allowRegister:a.coerce.boolean()});export{Jt as a,Kt as c,Gt as p,Ht as s};
